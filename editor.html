<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Editor RP</title>
<style>
body{background:#111;color:white;font-family:Arial;padding:20px}
textarea{width:100%;height:400px;background:#222;color:white;border:1px solid #444;padding:10px}
select,button{padding:10px;margin:10px 0}
</style>
</head>

<body>

<!-- üîí PROTECTION MOT DE PASSE -->
<script>
(function(){
const ok = sessionStorage.getItem("rp_editor_ok");
if(ok !== "yes"){
  const password = prompt("Mot de passe STAFF ?");
  if(password === "STAFF2026"){
    sessionStorage.setItem("rp_editor_ok","yes");
  } else {
    document.body.innerHTML = "<h1>‚õî Acc√®s refus√©</h1>";
    throw new Error("Access denied");
  }
}
})();
</script>

<h1>Editor RP</h1>

<select id="city"></select>
<br>
<textarea id="data"></textarea>
<br>

<button onclick="save()">üíæ Sauver</button>
<button onclick="del()">üóëÔ∏è Supprimer</button>
<button onclick="exportJSON()">‚¨áÔ∏è Export JSON</button>
<input type="file" id="import" accept="application/json">

<script src="data.js"></script>

<script>

let state = loadData();
let current = null;

function list(){
let s=document.getElementById("city");
s.innerHTML="";
state.regions.forEach(r=>{
r.cities.forEach(c=>{
let o=document.createElement("option");
o.value=c.id;
o.text=c.name;
s.appendChild(o);
});
});
}

function find(id){
for(let r of state.regions){
for(let c of r.cities){
if(c.id==id)return {r,c};
}
}
}

document.getElementById("city").onchange=e=>{
let f=find(e.target.value);
current=f;
document.getElementById("data").value=f.c.content;
};

function save(){
if(!current)return;
current.c.content=document.getElementById("data").value;
saveData(state);
alert("Sauv√©");
}

function del(){
if(!current)return;
current.r.cities=current.r.cities.filter(x=>x.id!==current.c.id);
saveData(state);
list();
}

function exportJSON(){
const blob=new Blob([JSON.stringify(state,null,2)],{type:"application/json"});
const url=URL.createObjectURL(blob);
const a=document.createElement("a");
a.href=url;
a.download="rdr2_rp_dossier.json";
a.click();
}

document.getElementById("import").addEventListener("change",async(e)=>{
const file=e.target.files[0];
const txt=await file.text();
state=JSON.parse(txt);
saveData(state);
list();
alert("Import OK");
});

list();

</script>

</body>
</html>
