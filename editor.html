<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dossier RP — Éditeur</title>

<style>
body{
background:#111;
color:white;
font-family:Arial;
margin:0;
padding:20px;
}
textarea{
width:100%;
height:500px;
background:#222;
color:white;
border:1px solid #444;
padding:10px;
}
button{
padding:10px;
margin:10px 0;
}
</style>
</head>

<body>

<script>
const password = prompt("Mot de passe ?");
if(password !== "STAFF2026"){
document.body.innerHTML = "<h1>Accès refusé</h1>";
throw new Error("Access denied");
}
</script>

<h1>Éditeur RP</h1>

<select id="city"></select>
<br>
<textarea id="data"></textarea>
<br>
<button onclick="save()">Sauver</button>
<button onclick="del()">Supprimer</button>

<script src="data.js"></script>

<script>
let state = loadData();
let current = null;

function list(){
let s = document.getElementById("city");
s.innerHTML="";
state.regions.forEach(r=>{
r.cities.forEach(c=>{
let o=document.createElement("option");
o.value=c.id;
o.text=c.name;
s.appendChild(o);
});
});
}

function find(id){
for(let r of state.regions){
for(let c of r.cities){
if(c.id==id)return {r,c};
}
}
}

document.getElementById("city").onchange=e=>{
let f=find(e.target.value);
current=f;
document.getElementById("data").value=f.c.content;
};

function save(){
if(!current)return;
current.c.content=document.getElementById("data").value;
saveData(state);
alert("Sauvé");
}

function del(){
if(!current)return;
current.r.cities=current.r.cities.filter(x=>x.id!==current.c.id);
saveData(state);
list();
}

list();
</script>

</body>
</html>
